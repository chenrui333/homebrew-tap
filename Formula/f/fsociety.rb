class Fsociety < Formula
  include Language::Python::Virtualenv

  desc "Modular Penetration Testing Framework"
  homepage "https://fsociety.dev/"
  url "https://files.pythonhosted.org/packages/c2/70/527a3971031a9783957c000be4f158ddfd4d17ec4d0390ea152f3a17aae4/fsociety-3.2.9.tar.gz"
  sha256 "ad49051ac04521b595926591a4cb865cce94f81cf7de18ae6cfe4b336ab00a93"
  license "MIT"

  bottle do
    root_url "https://ghcr.io/v2/chenrui333/tap"
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "126e51a1e83c8fb973ee23e559fc90fd195b33ba40d432470990e9f003380bcb"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "c9e81f95c209e72c518d50e65972f750f62d31f51dbdf01e884012190469febe"
    sha256 cellar: :any_skip_relocation, ventura:       "7cce4e99e034da264ea86e5e5d76cb65187c0096d02bd03e5baf710deb9312da"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "b6463de247908f5428bf68331c70793d6bfd9ab3818230b17f87aba31e0c1a1a"
  end

  depends_on "python@3.13"

  resource "certifi" do
    url "https://files.pythonhosted.org/packages/1c/ab/c9f1e32b7b1bf505bf26f0ef697775960db7932abeb7b516de930ba2705f/certifi-2025.1.31.tar.gz"
    sha256 "3d5da6925056f6f18f119200434a4780a94263f10d1c21d032a6f6b2baa20651"
  end

  resource "charset-normalizer" do
    url "https://files.pythonhosted.org/packages/16/b0/572805e227f01586461c80e0fd25d65a2115599cc9dad142fee4b747c357/charset_normalizer-3.4.1.tar.gz"
    sha256 "44251f18cd68a75b56585dd00dae26183e102cd5e0f9f1466e6df5da2ed64ea3"
  end

  resource "distro" do
    url "https://files.pythonhosted.org/packages/fc/f8/98eea607f65de6527f8a2e8885fc8015d3e6f5775df186e443e0964a11c3/distro-1.9.0.tar.gz"
    sha256 "2fa77c6fd8940f116ee1d6b94a2f90b13b5ea8d019b98bc8bafdcabcdd9bdbed"
  end

  resource "gitdb" do
    url "https://files.pythonhosted.org/packages/72/94/63b0fc47eb32792c7ba1fe1b694daec9a63620db1e313033d18140c2320a/gitdb-4.0.12.tar.gz"
    sha256 "5ef71f855d191a3326fcfbc0d5da835f26b13fbcba60c32c21091c349ffdb571"
  end

  resource "gitpython" do
    url "https://files.pythonhosted.org/packages/c0/89/37df0b71473153574a5cdef8f242de422a0f5d26d7a9e231e6f169b4ad14/gitpython-3.1.44.tar.gz"
    sha256 "c87e30b26253bf5418b01b0660f818967f3c503193838337fe5e573331249269"
  end

  resource "idna" do
    url "https://files.pythonhosted.org/packages/f1/70/7703c29685631f5a7590aa73f1f1d3fa9a380e654b86af429e0934a32f7d/idna-3.10.tar.gz"
    sha256 "12f65c9b470abda6dc35cf8e63cc574b1c52b11df2c86030af0ac09b01b13ea9"
  end

  resource "markdown-it-py" do
    url "https://files.pythonhosted.org/packages/38/71/3b932df36c1a044d397a1f92d1cf91ee0a503d91e470cbd670aa66b07ed0/markdown-it-py-3.0.0.tar.gz"
    sha256 "e3f60a94fa066dc52ec76661e37c851cb232d92f9886b15cb560aaada2df8feb"
  end

  resource "mdurl" do
    url "https://files.pythonhosted.org/packages/d6/54/cfe61301667036ec958cb99bd3efefba235e65cdeb9c84d24a8293ba1d90/mdurl-0.1.2.tar.gz"
    sha256 "bb413d29f5eea38f31dd4754dd7377d4465116fb207585f97bf925588687c1ba"
  end

  resource "pygments" do
    url "https://files.pythonhosted.org/packages/7c/2d/c3338d48ea6cc0feb8446d8e6937e1408088a72a39937982cc6111d17f84/pygments-2.19.1.tar.gz"
    sha256 "61c16d2a8576dc0649d9f39e089b5f02bcd27fba10d8fb4dcc28173f7a45151f"
  end

  resource "requests" do
    url "https://files.pythonhosted.org/packages/63/70/2bf7780ad2d390a8d301ad0b550f1581eadbd9a20f896afe06353c2a2913/requests-2.32.3.tar.gz"
    sha256 "55365417734eb18255590a9ff9eb97e9e1da868d4ccd6402399eaf68af20a760"
  end

  resource "rich" do
    url "https://files.pythonhosted.org/packages/ab/3a/0316b28d0761c6734d6bc14e770d85506c986c85ffb239e688eeaab2c2bc/rich-13.9.4.tar.gz"
    sha256 "439594978a49a09530cff7ebc4b5c7103ef57baf48d5ea3184f21d9a2befa098"
  end

  resource "smmap" do
    url "https://files.pythonhosted.org/packages/44/cd/a040c4b3119bbe532e5b0732286f805445375489fceaec1f48306068ee3b/smmap-5.0.2.tar.gz"
    sha256 "26ea65a03958fa0c8a1c7e8c7a58fdc77221b8910f6be2131affade476898ad5"
  end

  resource "urllib3" do
    url "https://files.pythonhosted.org/packages/aa/63/e53da845320b757bf29ef6a9062f5c669fe997973f966045cb019c3f4b66/urllib3-2.3.0.tar.gz"
    sha256 "f8c5449b3cf0861679ce7e0503c7b44b5ec981bec0d1d3795a07f1ba96f0204d"
  end

  # upstream pr ref, https://github.com/fsociety-team/fsociety/pull/279
  resource "requirements.txt" do
    url "https://raw.githubusercontent.com/fsociety-team/fsociety/refs/tags/v3.2.9/requirements.txt"
    sha256 "a4088b398a4e607f0174a247dc2674089d666cb5913ef429850829eaab0b8f34"
  end
  resource "requirements-dev.txt" do
    url "https://raw.githubusercontent.com/fsociety-team/fsociety/refs/tags/v3.2.9/requirements-dev.txt"
    sha256 "453b380908a78c0c12d6fc97fb943b4d21f906a451ad8e4c1d79430d618fa3f1"
  end

  def install
    buildpath.install resource("requirements.txt")
    buildpath.install resource("requirements-dev.txt")
    virtualenv_install_with_resources without: ["requirements.txt", "requirements-dev.txt"]
  end

  test do
    assert_match version.to_s, shell_output("#{bin}/fsociety --info")
    system bin/"fsociety", "--suggest"
  end
end
